<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sign in</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@azure/msal-browser@2.38.3/lib/msal-browser.min.js"></script>
</head>
<body>
  <main class="login-page">
    <header class="site-brand-wrap">
      <a class="site-brand d-flex align-items-center gap-2" href="/">
        <i class="bi bi-grid-1x2-fill site-brand-icon"></i>
        <span class="site-brand-text">Training Manager</span>
      </a>
    </header>

    <div class="login-card">
      <h1 class="login-title">Sign in</h1>
      <button id="btnLogin" class="btn-primary">
          <img src="../Assets/Microsoft.png" alt="Microsoft logo" class="ms-logo" />
        <span>Continue with Microsoft</span>
      </button>
      </div>
    </main>
    <script>
    </div>
  </main>
  <script>
    const msalConfig = {
      auth: {
        clientId: "YOUR_CLIENT_ID",
        // Only organisational accounts
        authority: "https://login.microsoftonline.com/organizations",
        redirectUri: window.location.origin + "/login",
        postLogoutRedirectUri: window.location.origin + "/login",
        navigateToLoginRequestUrl: false
      },
      cache: { cacheLocation: "sessionStorage" }
    };
    const msalInstance = new msal.PublicClientApplication(msalConfig);

    // Required in redirect flow to complete the auth code exchange
    msalInstance.handleRedirectPromise().then((result) => {
      const account = result?.account || msalInstance.getAllAccounts()[0];
      if (account) {
        // Persist minimal session (you may mint your own session cookie via your API instead)
        sessionStorage.setItem("account", JSON.stringify(account));
        // Go to your app shell
        window.location.replace("/app");
      }
    });

    document.getElementById("btnLogin").addEventListener("click", () => {
      msalInstance.loginRedirect({
        scopes: ["openid", "profile", "email"] // add "User.Read" if you want MS Graph
      });
    });
  </script>
</body>
</html>