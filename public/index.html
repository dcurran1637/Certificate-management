<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Training Manager</title>

  <!-- Bootstrap CSS + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-body-tertiary">

  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
    <div class="container-fluid px-3">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#/dashboard">
        <i class="bi bi-grid-1x2-fill text-primary"></i>
        <span>Training Manager</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topNav" aria-controls="topNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="topNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-2" id="mainNav">
          <li class="nav-item">
            <a class="nav-link" data-route="/dashboard" href="#/dashboard">
              <i class="bi bi-speedometer2 me-1"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-route="/people" href="#/people">
              <i class="bi bi-people me-1"></i>People
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-route="/reports" href="#/reports">
              <i class="bi bi-clipboard-data me-1"></i>Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-route="/my-training" href="#/my-training">
              <i class="bi bi-person-badge me-1"></i>My Training
            </a>
          </li>
        </ul>

        <div class="d-flex align-items-center gap-2">
          <a id="btnLogout" class="btn btn-outline-secondary btn-sm" href="Login.html">
            <i class="bi bi-box-arrow-right me-1"></i> Logout
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- SPA root: pages are injected here -->
  <main class="container my-4" id="app-root" aria-live="polite"></main>

  <!-- ========= Page Templates ========= -->

  <!-- Dashboard -->
  <template id="tpl-dashboard">
    <div class="d-flex flex-column flex-md-row justify-content-between gap-3 align-items-start align-items-md-center mb-3">
      <div>
        <h1 class="h3 mb-1">Training Management</h1>
        <p class="text-secondary mb-0 small">Track and manage employee training and certifications</p>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-light d-flex align-items-center gap-2" id="btnNewCourse">
          <i class="bi bi-plus-lg"></i> New Course
        </button>
        <button class="btn btn-dark d-flex align-items-center gap-2" id="btnAddTraining">
          <i class="bi bi-plus-lg"></i> Add Training Record
        </button>
        <button class="btn btn-warning d-flex align-items-center gap-2" id="btnAddThirdParty">
          <i class="bi bi-file-earmark-plus"></i> 3rd-Party Certificate
        </button>
      </div>
    </div>

    <section class="row g-3 mb-3">
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-secondary small">Total Staff</span>
              <span class="icon-badge bg-primary-subtle text-primary"><i class="bi bi-people"></i></span>
            </div>
            <div class="display-6 fw-semibold mt-1" id="statStaff">0</div>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-secondary small">Active Courses</span>
              <span class="icon-badge bg-purple-subtle text-purple"><i class="bi bi-collection-play"></i></span>
            </div>
            <div class="display-6 fw-semibold mt-1" id="statCourses">0</div>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-secondary small">Expiring Soon</span>
              <span class="icon-badge bg-warning-subtle text-warning"><i class="bi bi-hourglass-split"></i></span>
            </div>
            <div class="display-6 fw-semibold mt-1" id="statExpiring">0</div>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-secondary small">Current Certifications</span>
              <span class="icon-badge bg-success-subtle text-success"><i class="bi bi-check2-circle"></i></span>
            </div>
            <div class="display-6 fw-semibold mt-1" id="statCerts">0</div>
          </div>
        </div>
      </div>
    </section>

    <ul class="nav nav-tabs small mb-3" id="tmTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="calendar-tab" data-bs-toggle="tab" data-bs-target="#calendar" type="button" role="tab" aria-controls="calendar" aria-selected="true">Calendar</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="records-tab" data-bs-toggle="tab" data-bs-target="#records" type="button" role="tab" aria-controls="records" aria-selected="false">All Records</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="courses-tab" data-bs-toggle="tab" data-bs-target="#courses" type="button" role="tab" aria-controls="courses" aria-selected="false">Courses</button>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="calendar" role="tabpanel" aria-labelledby="calendar-tab">
        <div class="card mb-3">
          <div class="card-body">
            <h2 class="h6 mb-3 d-flex align-items-center gap-2">
              <i class="bi bi-calendar-event text-primary"></i>
              Upcoming Certification Expiries
            </h2>
            <div class="empty-state text-secondary small">
              No upcoming expiries in the next 90 days
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="records" role="tabpanel" aria-labelledby="records-tab">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h2 class="h6 mb-0">All Training Records</h2>
              <div class="d-flex gap-2">
                <input class="form-control form-control-sm" placeholder="Search…" id="recordSearch" />
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-sm align-middle">
                <thead>
                  <th scope="col">Employee</th>
                  <th scope="col">Course</th>
                  <th scope="col">Completed</th>
                  <th scope="col">Expires</th>
                  <th scope="col">Assessor</th>
                  <th scope="col">Status</th>
                  <th scope="col" class="text-end">Actions</th>
                </thead>
                <tbody id="recordsTbody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="courses" role="tabpanel" aria-labelledby="courses-tab">
        <div class="card">
          <div class="card-body">
            <h2 class="h6">Courses</h2>
            <div class="table-responsive">
              <table class="table table-sm align-middle">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Category</th>
                    <th>Provider</th>
                    <th>Valid (days)</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody id="courseTbody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <!-- People -->
  <template id="tpl-people">
    <h1 class="h3">People</h1>
    <p class="text-secondary small mb-3">Manage all staff, students, and trainees</p>

    <div class="card">
      <div class="card-body">
        <h2 class="h6 d-flex align-items-center gap-2 mb-3">
          <i class="bi bi-person-lines-fill"></i>
          <span>All People (<span id="peopleCount">0</span>)</span>
        </h2>
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Total Training</th>
                <th>Current</th>
                <th>Expiring Soon</th>
                <th>Expired</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="peopleTbody">
              <!-- rows injected -->
            </tbody>
          </table>
        </div>
        <div class="text-center text-secondary small py-3 d-none" id="peopleEmpty">No people found</div>
      </div>
    </div>
  </template>

  <!-- Reports -->
  <template id="tpl-reports">
    <h1 class="h3">Training Reports</h1>
    <p class="text-secondary small mb-3">Generate and export training reports</p>

    <div class="card mb-3">
      <div class="card-body">
        <div class="d-flex flex-wrap justify-content-between align-items-end gap-3">
  
              <!-- LEFT SIDE (filters inline) -->
              <div class="d-flex flex-wrap align-items-end gap-3">
                
                <!-- Report Type -->
                <div>
                  <label class="form-label small mb-1">Report Type</label>
                  <select class="form-select form-select-sm" id="reportType">
                    <option value="all">All Training Records</option>
                    <option value="valid">Valid</option>
                    <option value="expiring">Expiring in 90 days</option>
                    <option value="expired">Expired</option>
                  </select>
                </div>

                <!-- Person Filter -->
                <div>
                  <label class="form-label small mb-1">Person</label>
                  <select class="form-select form-select-sm" id="reportPerson">
                    <option value="">All people</option>
                  </select>
                </div>

                <div class="small text-secondary ms-2">
                  <span id="reportCount">0</span> records found
                </div>

              </div>

              <!-- RIGHT SIDE (Export Button) -->
              <button class="btn btn-secondary btn-sm" id="btnExportCsv">
                <i class="bi bi-filetype-csv me-1"></i> Export to CSV
              </button>
            </div>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <h2 class="h6 mb-3">Report Results</h2>
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>Staff Name</th>
                <th>Email</th>
                <th>Course</th>
                <th>Completed</th>
                <th>Expires</th>
                <th>Assessor</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="reportTbody"></tbody>
          </table>
        </div>
        <div class="text-center text-secondary small py-3 d-none" id="reportEmpty">No records found for the selected criteria</div>
      </div>
    </div>
  </template>

  <!-- My Training -->
  <template id="tpl-mytraining">
    <h1 class="h3">My Training</h1>
    <p class="text-secondary small mb-3">View your training history and certifications</p>

    <section class="row g-3 mb-3">
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100"><div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-secondary small">Total Training</span>
            <span class="icon-badge bg-primary-subtle text-primary"><i class="bi bi-award"></i></span>
          </div>
          <div class="display-6 fw-semibold mt-1" id="myTotal">0</div>
        </div></div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100"><div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-secondary small">Current</span>
            <span class="icon-badge bg-success-subtle text-success"><i class="bi bi-check2-circle"></i></span>
          </div>
          <div class="display-6 fw-semibold mt-1" id="myCurrent">0</div>
        </div></div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100"><div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-secondary small">Expiring Soon</span>
            <span class="icon-badge bg-warning-subtle text-warning"><i class="bi bi-hourglass-split"></i></span>
          </div>
          <div class="display-6 fw-semibold mt-1" id="myExpiring">0</div>
        </div></div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card stat-card h-100"><div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-secondary small">Expired</span>
            <span class="icon-badge bg-danger-subtle text-danger"><i class="bi bi-x-circle"></i></span>
          </div>
          <div class="display-6 fw-semibold mt-1" id="myExpired">0</div>
        </div></div>
      </div>
    </section>

    <div class="card">
      <div class="card-body">
        <h2 class="h6 d-flex align-items-center gap-2 mb-3">
          <i class="bi bi-award"></i> <span>My Training Records</span>
        </h2>
        <div class="mt-2 d-flex gap-2">
          <a 
            id="btnSubCalendar" 
            class="btn btn-outline-primary btn-sm"
            target="_blank">
            Subscribe in Outlook
          </a>

          <a 
            id="btnExportCalendar" 
            class="btn btn-outline-secondary btn-sm"
            target="_blank">
            Download All ICS
          </a>
        </div>
        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
              <tr>
                <th>Course</th>
                <th>Completed</th>
                <th>Expires</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="myTbody"></tbody>
          </table>
        </div>
        <div class="text-center text-secondary small py-5" id="myEmpty" hidden>
          <i class="bi bi-award fs-1 d-block mb-2"></i>
          No training records found
        </div>
      </div>
    </div>
  </template>
  <!-- ========= /Page Templates ========= -->

  <!-- ========================= CREATE COURSE MODAL ========================= -->
  <div class="modal fade" id="courseModal" tabindex="-1" aria-labelledby="courseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <form id="courseForm">
          <div class="modal-header">
            <h5 class="modal-title" id="courseModalLabel">Create Training Course</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Course Name</label>
              <input type="text" class="form-control" id="courseName" placeholder="e.g., Fire Marshall Certification" required />
            </div>

            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" id="courseDesc" rows="3" placeholder=""></textarea>
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Type</label>
                <select class="form-select" id="courseType">
                  <option value="Individual Training">Individual Training</option>
                  <option value="Group Training">Group Training</option>
                  <option value="Online / eLearning">Online / eLearning</option>
                  <option value="Assessment">Assessment</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Category</label>
                <select class="form-select" id="courseCategory">
                  <option value="Other">Other</option>
                  <option value="Safety">Safety</option>
                  <option value="First Aid">First Aid</option>
                  <option value="Compliance">Compliance</option>
                  <option value="Technical">Technical</option>
                </select>
              </div>
            </div>

            <div class="row g-3 mt-0">
              <div class="col-md-6">
                <label class="form-label">Valid for (days)</label>
                <input type="number" min="0" class="form-control" id="courseValidDays" placeholder="e.g., 365" />
                <div class="form-text">Leave blank for no expiry</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Provider (Optional)</label>
                <input type="text" class="form-control" id="courseProvider" placeholder="e.g., Fire Safety UK" />
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-dark" id="btnCreateCourse">Create Course</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ======================= ADD TRAINING RECORD MODAL ==================== -->
  <div class="modal fade" id="recordModal" tabindex="-1" aria-labelledby="recordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <form id="recordForm">
          <div class="modal-header">
            <h5 class="modal-title" id="recordModalLabel">Add Training Record</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Staff Name</label>
                <input type="text" class="form-control" id="recName" required />
              </div>
              <div class="col-md-6">
                <label class="form-label">Staff Email</label>
                <input type="email" class="form-control" id="recEmail" required />
              </div>
            </div>

            <div class="row g-3 mt-0">
              <div class="col-md-12">
                <label class="form-label">Training Course</label>
                <select class="form-select" id="recCourse" required>
                  <!-- populated by app.js -->
                </select>
              </div>
            </div>

            <div class="row g-3 mt-0">
              <div class="col-md-12">
                <label class="form-label">Completion Date</label>
                <input type="date" class="form-control" id="recCompleted" required />
              </div>
            </div>
            <div class="row g-3 mt-0">
              <div class="col-md-12">
                <label class="form-label">Assessor (optional)</label>
                <input type="text" class="form-control" id="recAssessor" placeholder="Assessor"></select>
              </div>
            </div>
                <div class="row g-3 mt-0">
              <div class="col-md-12">
                <label class="form-label">Certificate/Evidence (Optional)</label>
                <input type="file" class="form-control" id="recFile" />
              </div>
            </div>

            <div class="mb-0 mt-3">
              <label class="form-label">Notes (Optional)</label>
              <textarea class="form-control" id="recNotes" rows="3" placeholder=""></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-dark" id="btnAddRecord">Add Record</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ======================= ADD 3RD-PARTY CERT MODAL ===================== -->
  <div class="modal fade" id="thirdPartyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <form id="thirdPartyForm">
          <div class="modal-header">
            <h5 class="modal-title">Add 3rd-Party Certification</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label class="form-label">Certification Title</label>
              <input type="text" class="form-control" id="tpTitle" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Provider</label>
              <input type="text" class="form-control" id="tpProvider" required>
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Completion Date</label>
                <input type="date" class="form-control" id="tpCompleted" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Expiry Date (optional)</label>
                <input type="date" class="form-control" id="tpExpiry">
              </div>
            </div>

            <div class="mb-3 mt-3">
              <label class="form-label">Evidence File</label>
              <input type="file" id="tpFile" class="form-control">
            </div>

            <label class="form-label">Notes</label>
            <textarea class="form-control" id="tpNotes" rows="3"></textarea>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-warning">Save Certificate</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ===== Toast Host (top-right) ===== -->
  <div class="toast-container position-fixed top-0 end-0 p-3" id="toastHost" style="z-index: 3000;"></div>

  <!-- ===== Person Profile Modal ===== -->
  <div class="modal fade" id="personModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
  <div>
    <h5 class="modal-title" id="personName">Person</h5>
    <div class="small text-secondary" id="personEmail"></div>

    <!-- ROLE SELECT (admins only) -->
    <div id="roleControl" class="mt-2 d-none">
      <label class="form-label small mb-1">Role</label>
      <select class="form-select form-select-sm w-auto" id="personRoleSelect">
        <option value="user">User</option>
        <option value="manager">Manager</option>
        <option value="admin">Admin</option>
      </select>
    </div>

    <!-- ICS buttons (internal + 3rd-party combined) -->
    <div class="mt-2 d-flex gap-2" id="profileIcsButtons">
      <a
        id="profileBtnSubscribe"
        class="btn btn-outline-primary btn-sm"
        target="_blank"
      >
        <i class="bi bi-calendar-plus me-1"></i> Subscribe in Outlook
      </a>

      <a
        id="profileBtnExport"
        class="btn btn-outline-secondary btn-sm"
        target="_blank"
      >
        <i class="bi bi-download me-1"></i> Download All ICS
      </a>
    </div>
  </div>

  <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

        <div class="modal-body">
          <ul class="nav nav-pills mb-3" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabPersonTraining" type="button">Training Records</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabPersonThirdParty" type="button">3rd‑Party Certifications</button></li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane fade show active" id="tabPersonTraining">
              <div id="personTrainingSpinner" class="text-center py-4 d-none">
                <div class="spinner-border" role="status"></div>
                <div class="small text-secondary mt-2">Loading training…</div>
              </div>
              <div class="table-responsive">
                <table class="table table-sm align-middle">
                  <thead>
                     <tr>
                      <th>Course</th>
                      <th>Completed</th>
                      <th>Expires</th>
                      <th>Assessor</th>
                    </tr>
                  </thead>
                  <tbody id="personTrainingTbody"></tbody>
                </table>
              </div>
              <div id="personTrainingEmpty" class="text-center text-secondary small py-3 d-none">No training records</div>
            </div>

            <div class="tab-pane fade" id="tabPersonThirdParty">
              <div class="d-flex justify-content-end mb-2">
                <button class="btn btn-warning btn-sm" id="btnProfileAddThird">
                  <i class="bi bi-file-earmark-plus"></i> Add 3rd‑Party Certificate
                </button>
              </div>
              <div id="personThirdSpinner" class="text-center py-4 d-none">
                <div class="spinner-border" role="status"></div>
                <div class="small text-secondary mt-2">Loading certifications…</div>
              </div>
              <div class="table-responsive">
                <table class="table table-sm align-middle">
                  <thead>
                    <tr>
                      <th>Title</th><th>Provider</th><th>Completed</th><th>Expiry</th><th class="text-end">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="personThirdTbody"></tbody>
                </table>
              </div>
              <div id="personThirdEmpty" class="text-center text-secondary small py-3 d-none">No 3rd‑party certifications</div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-light" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Edit Training Record Modal ===== -->
  <div class="modal fade" id="editRecordModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <form id="editRecordForm">
          <div class="modal-header">
            <h5 class="modal-title">Edit Training Record</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editRecId">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Course</label>
                <select class="form-select" id="editRecCourse" required></select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Completion Date</label>
                <input type="date" class="form-control" id="editRecCompleted" required>
              </div>
            </div>
            <div class="mt-3">
              <label class="form-label">Assessor</label>
              <input type="text" id="editRecAssessor" class="form-control" placeholder="Assessor name">
            </div>
            <div class="mt-3">
              <label class="form-label">Notes</label>
              <textarea id="editRecNotes" class="form-control" rows="3"></textarea>
            </div>
            <div class="mt-3">
              <label class="form-label">Replace Evidence (optional)</label>
              <input type="file" class="form-control" id="editRecFile">
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ===== Edit 3rd‑Party Certification Modal ===== -->
  <div class="modal fade" id="editThirdPartyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <form id="editThirdForm">
          <div class="modal-header">
            <h5 class="modal-title">Edit 3rd‑Party Certification</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="editThirdId">
            <div class="mb-3">
              <label class="form-label">Certification Title</label>
              <input type="text" class="form-control" id="editThirdTitle" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Provider</label>
              <input type="text" class="form-control" id="editThirdProvider" required>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Completion Date</label>
                <input type="date" class="form-control" id="editThirdCompleted" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Expiry (optional)</label>
                <input type="date" class="form-control" id="editThirdExpiry">
              </div>
            </div>
            <div class="mt-3">
              <label class="form-label">Replace Evidence (optional)</label>
              <input type="file" class="form-control" id="editThirdFile">
            </div>
            <div class="mt-3">
              <label class="form-label">Notes</label>
              <textarea class="form-control" id="editThirdNotes" rows="3"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" type="submit">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ===== Confirm Delete Modal (generic) ===== -->
  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title" id="confirmDeleteTitle">Confirm Delete</h6>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="confirmDeleteText">Are you sure you want to delete this item?</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS + App -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="app.js"></script>

  <!-- Logout: destroys session and clears local storage -->
  <script>
    document.getElementById('btnLogout')?.addEventListener('click', async function (e) {
      e.preventDefault();
      try {
        await fetch(`${API}/api/auth/logout`, { method: "POST", credentials: "include" });
      } catch (err) {
        console.warn("Logout request failed:", err);
      }
      try { sessionStorage.clear(); localStorage.clear(); } catch (err) {}
      window.location.href = 'Login.html';
    });
  </script>
</body>
</html>